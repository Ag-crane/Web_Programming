
비동기 처리

자바스크립트 : 싱글 쓰레드만 쓴다고 가정

task 큐랑 UI 큐에 어떤 순서대로 들어가는지 ... 시험문제

UI큐가 우선순위가 더 높음
UI큐가 비어있을 때 task 큐 처리
UI큐 먼저 다 처리해야하기 때문에 콜백 실행까지 걸리는 시간이 더 걸릴 수 있다. 3ms 기다리라고 설정해도 더 이상 걸릴 수 있음

task큐 는 세가지로 분리돼있음 
- AnimationFrame :
개발자가 직접, 16ms 이내에 처리돼서 UI에 영향을 안줄것같은 작업들을 넣는다
- Macro :
시간이 얼마나 걸릴 지 모르는 덩어리가 큰 작업들을 뒤로 넣는다
- Micro (노드 제이슨 환경에서 추가됨)

기본적으로 UI큐가 쓰레드를 선점하고있고,
그 어떤 경우에도 UI 큐가 멈추면 안된다.
Macro큐 작업이 너무 길어져서 화면이 버벅거리는 것처럼 보이는 경우는 있다

setTimeout을 실행하는건 UI큐에서. 그 안의 콜백함수는 macro큐에 등록됨


3초 뒤 백종원찌개로 바꿔라
바꾼 다음 3초 뒤에 백종원을 빨간색으로 바꿔라

방법은 2가지
1. 3초 백종원찌개 -> 3초 빨간색
2. 3초 백종원찌개 + 6초 빨간색 동시에 등록
실제로 화면에 구현했을땐 거의 똑같지만
엄밀히 따지면
1번 방법은 0.5초 밀리면 0.5초 같이 밀리는데
(실행 간격이 항상 3초)
2번 방법은 0.5초 밀려도 6초뒤엔 빨간색됨
(두 콜백함수의 실행 간격이 3초 이내가 될 수 있음)
2번은 만약 너무 많이 밀리면 앞에 3초가 거의 생략된것처럼 보일 수 있음

open API 사용가능여부 확인되면
open API에 서울 데이터 요청
받으면
open API에 중구 데이터 요청
요청 -> 요청확인 -> 받고 결과확인 -> 요청

이걸 2번 방법으로 구현하려고 하면 한계가 있음


let ok = OPEN API 사용 여부
if (ok==false) 
	error!
	return
성공한다 치고~
let seoul = OPEN API 서울 데이터
let data = OPEN API( seoul.중구 )의 미세먼지 데이터 요청
document.getElement~.innerHTML = data

OPEN API 네트워크에 요청하고 데이터를 받아오는 과정은
UI 쓰레드에서 실행할 수 없음
함수 앞에 async 키워드 붙이면
"이 함수는 UI쓰레드(메인쓰레드) 밖에서 실행됩니다 = 무조건 task큐로 넘어가서 비동기적으로 처리" => OPEN API 받아오는 과정 이제 다 할 수 있음
await 키워드 : 성공하든 실패하든 결과가 나올때까지 기다려줌
await 키워드 쓰려면 함수를 async 키워드로 감싸줘야함

async function myfunc(){
	let ok = await OPEN API 사용 여부
	let seoul = await OPEN API 서울 데이터
	let data = await OPEN API( seoul.중구 )의 미세먼지 데이터 요청
	document.getElement~.innerHTML = data
}
<button onclick = "myfunc()">
onclick 함수는 UI쓰레드에서, myfunc 함수는 task 큐에서 실행
비동기적 처리 시 task큐에 작업을 던지기만 하고 그 함수는 끝나고 바로 다음 코드가 실행되므로 주의할 것